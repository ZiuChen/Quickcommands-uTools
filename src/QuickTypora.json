{"program":"quickcommand","cmd":"/*\r\n  author: Twiliness ZiuChen\r\n  description: 原插件不支持自定义位置安装的Typora, 故将原插件略作修改, 可以指定`TYPORA_PATH`\r\n  v0.0.1\r\n*/\r\n\r\nconst process = require('process')\r\nconst child_process = require('child_process')\r\n\r\nconst fs = require('fs')\r\nconst fp = fs.promises\r\nconst path = require('path')\r\n\r\nconst TYPORA_PATH = 'D:\\\\Typora\\\\Typora.exe' // Typora 自定义安装位置\r\n\r\nfunction getUserHome() {\r\n  return process.env.HOME || process.env.USERPROFILE\r\n}\r\n\r\nfunction getDefaultTyporaHistoryPath() {\r\n  return path.join(getUserHome(), '/AppData/Roaming', '/Typora/history.data')\r\n}\r\n\r\nasync function getTyporaExecutablePath() {\r\n  return new Promise((resolve, reject) => {\r\n    resolve(TYPORA_PATH)\r\n  })\r\n}\r\n\r\nasync function getTyporaFileIconPath(fullPath) {\r\n  const parsedPath = path.parse(fullPath)\r\n  const dir = parsedPath['dir']\r\n  const assetsPath = path.join(dir, '/resources/app/asserts')\r\n\r\n  const fileIco = 'file://' + path.join(assetsPath, 'file.ico')\r\n  const appIco = 'file://' + path.join(assetsPath, 'app.ico')\r\n\r\n  return Promise.resolve([fileIco, appIco])\r\n}\r\n\r\nasync function deserializeDatabase(fullPath) {\r\n  const data = await fp.readFile(fullPath, { encoding: 'utf-8' })\r\n  try {\r\n    const buffer = new Buffer.from(data || '', 'hex')\r\n    const json = JSON.parse(buffer.toString())\r\n    return Promise.resolve(json)\r\n  } catch (error) {\r\n    return Promise.reject(error)\r\n  }\r\n}\r\n\r\nasync function getRecentDocumentAndFolder() {\r\n  const fullPath = getDefaultTyporaHistoryPath()\r\n  const db = await deserializeDatabase(fullPath)\r\n  const execPath = await getTyporaExecutablePath()\r\n  const ico = await getTyporaFileIconPath(execPath)\r\n  let document = db.recentDocument || []\r\n  let folder = db.recentFolder || []\r\n\r\n  console.log('数据库记录的最近文档', document)\r\n  console.log('数据库记录的最近目录', folder)\r\n\r\n  document = document.filter((doc) => {\r\n    return fs.existsSync(doc['path'])\r\n  })\r\n\r\n  folder = folder.filter((fold) => {\r\n    return fs.existsSync(fold['path'])\r\n  })\r\n\r\n  console.log('有效的最近文档', document)\r\n  console.log('有效的最近目录', folder)\r\n\r\n  const result = document\r\n    .map((v) => {\r\n      return {\r\n        title: v['name'],\r\n        description: '文件路径: ' + v['path'],\r\n        icon: ico[0],\r\n        path: v['path']\r\n      }\r\n    })\r\n    .concat(\r\n      folder.map((v) => {\r\n        return {\r\n          title: v['name'],\r\n          description: '目录路径: ' + v['path'],\r\n          icon: ico[1],\r\n          path: v['path']\r\n        }\r\n      })\r\n    )\r\n  return Promise.resolve(result)\r\n}\r\n\r\nasync function get() {\r\n  const result = await getRecentDocumentAndFolder()\r\n\r\n  return Promise.resolve(result)\r\n}\r\n\r\nasync function execute(data) {\r\n  const execPath = await getTyporaExecutablePath()\r\n\r\n  utools.hideMainWindow()\r\n  child_process.spawn(execPath, [data['path']], {\r\n    detached: true\r\n  })\r\n  utools.outPlugin()\r\n\r\n  return Promise.resolve()\r\n}\r\n\r\nconst enter = async () => {\r\n  const result = await get()\r\n  quickcommand.showSelectList(result, { optionType: 'json' }).then((choise) => execute(choise))\r\n}\r\n\r\nenter()\r\n","scptarg":"","charset":{"scriptCode":"","outputCode":""},"customOptions":{"bin":"","argv":"","ext":""},"features":{"explain":"快速打开Typora中最近的文件或文件夹","platform":["win32"],"icon":"data:image/png;base64,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","code":"key_12t78u0ebzx","cmds":["typo"]},"output":"nothing","tags":[],"hasSubInput":false}